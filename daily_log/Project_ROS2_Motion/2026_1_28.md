### [프로젝트 포트폴리오 요약] 반도체 Task Handler 자동화 시스템 개발

#### 0. 금일 작업 및 프로젝트 요약
* **프로젝트명:** 반도체 패키지 핸들링 및 테스트 공정 자동화 (Sequential Pick & Place)
* **기간:** 2주 (단기 집중 개발, 1/13~1/26)
* **역할:** **PM (Project Manager)** 및 **ROS2 시스템 아키텍트**
* **사용 장비/기술:** Doosan Robotics M0609, ROS2(Foxy/Humble), Python, Firebase (RTDB), Force/Torque Sensor
* **핵심 성과:** Firebase 기반의 'Postbox' 비동기 통신 아키텍처를 설계하여 Web UI와 로봇 제어 시스템 간의 실시간성(약 200ms)과 안정성을 확보하고, ROS2 노드 모듈화를 통해 협업 효율성을 극대화함.

---

#### 1. 문제 인식 (Problem Definition)
* **공정의 비효율성 및 품질 이슈:** 기존 반도체 테스트 공정(TDBI 등)에서 수작업으로 인한 작업자 피로도 누적과 단순 반복 작업의 비효율성을 개선해야 함.
* **정밀 제어의 필요성:** 반도체 소켓 삽입 시 **106.8N** 이상의 충격이 가해지거나 삽입 횟수 제한(25회)을 초과할 경우 소켓 및 패키지 파손(내구성 저하) 위험이 존재함.
* **Jamming 현상 극복:** 단순 수직 삽입(Vertical Insertion) 방식은 미세한 위치 오차에도 부품이 입구에 끼이는 'Jamming' 현상을 유발하여 공정 실패로 이어지는 구조적 한계가 확인됨. 

---

#### 2. 접근 방식 (Approach & Architecture)
**[Role: PM & System Integrator]**
* **모듈형 시스템 설계 (Modular Architecture):**
    * 전체 시스템을 단일 스크립트가 아닌 기능별 노드(`task_node`, `hw_node`, `ui_node`)로 분리하여 개발 복잡도를 낮추고 팀원 간 병렬 개발이 가능한 환경을 구축함.
    * `hw_node`를 통해 하드웨어를 추상화하고, `pose_config.yaml`을 통해 티칭 포인트와 시스템 파라미터를 별도로 관리하여 유지보수성을 높임.
* **Postbox 비동기 통신 아키텍처 도입:**
    * 로봇 제어부(ROS2)와 사용자 인터페이스(Web) 간의 직접 결합을 피하기 위해 **Firebase RTDB**를 미들웨어로 활용한 '중계형 아키텍처'를 설계함. 

[Image of firebase realtime database architecture]

    * 네트워크 불안정 상황에서도 데이터 유실을 방지하고, 0.2초 주기의 Polling 방식을 통해 실시간 상태 모니터링(Joint State, Error)을 구현함.
* **알고리즘 고도화 전략:**
    * 초기 상/하 탐색 알고리즘의 한계를 인정하고, F/T 센서(힘/토크 센서) 데이터를 기반으로 한 **'슬라이드 알고리즘(Slide Algorithm)'**을 채택하여 삽입 성공률과 공정 유연성을 확보함.

---

#### 3. 해결 솔루션 (Solution Implementation)
* **ROS2 기반 제어 시스템 통합:**
    * `DSR_ROBOT2` API를 활용하여 매니퓰레이터의 모션 제어를 수행하는 전용 인터페이스 패키지를 구축함.
    * `/dsr01/task_command` 토픽을 통해 상위 제어 명령을 수신하고, `/tool_force` 토픽을 통해 실시간 힘 데이터를 발행하여 피드백 제어 루프를 완성함.
* **정밀 조립을 위한 슬라이드 알고리즘 구현:**
    * 수직 Z축 힘(Fz)과 Y축 토크(Ty)의 변화량을 트리거로 설정하여, 소켓 입구에서 자연스럽게 부품이 미끄러져 들어가는 동작을 구현함.
    * 센서 노이즈로 인한 오작동을 방지하기 위해 Z축 위치(Position) 조건을 추가 조건으로 결합하여 판단 신뢰성을 강화함.
* **안전 기능(Safety Feature) 구현:**
    * Web UI에서 비상 정지(Emergency Stop) 명령 수신 시, ROS2 Service(`system/set_robot_mode`)와 연동하여 즉각적인 로봇 정지 및 복구(Reset) 프로세스를 구현함.

---

#### 4. 기반 기술 및 트러블 슈팅 (Core Tech & Troubleshooting)

**이슈 1: 특이점(Singularity)으로 인한 모션 불안정**
* **증상:** `moveL`(직선 보간) 명령 수행 중, 3번/4번 관절이 급격히 회전하며 로봇이 비정상적으로 가속하거나 정지하는 현상 발생. 에러 메시지는 출력되지 않음.
* **원인:** 시작점과 목표점 사이의 경로가 로봇의 기구학적 특이점 영역을 통과하면서 역기구학(IK) 해가 발산함. 
* **조치:**
    1. 특이점 구간을 회피하기 위해 경유점(Waypoint, Z축 +20 등)을 추가.
    2. 직선 이동이 불필요한 구간에 대해 `moveJ`(관절 보간)로 이동 방식을 변경하여 관절 부하를 최소화.
* **결과:** 전체 사이클 타임은 약 3초 증가했으나, 모션의 안정성을 확보하고 하드웨어 과부하를 방지함.

**이슈 2: 힘 제어 루프의 Blocking 현상**
* **증상:** 힘 제어 알고리즘 실행 시, 전체 프로그램 흐름이 멈추고 다음 명령을 수행하지 못하는 'Hang' 상태 발생.
* **원인:** 힘 센서 값을 모니터링하는 `while` 루프가 메인 스레드를 점유하여 ROS2의 콜백 함수 및 통신 처리를 차단함.
* **조치:** 힘 제어 로직을 메인 루프에서 분리하고, 제어 흐름을 재구성(Re-factoring)함.
* **결과:** 실시간 힘 데이터 모니터링과 동시에 모션 명령 처리가 가능한 환경 구축.

**이슈 3: 수직 삽입 시 Jamming 발생**
* **증상:** 핀과 소켓의 미세한 위치 오차로 인해 부품이 입구에 걸려 더 이상 진입하지 못하는 현상.
* **원인:** 강체(Rigid) 제어 방식의 로봇이 위치 오차를 물리적으로 보정하지 못해 과도한 힘이 발생.
* **조치:** 로봇의 End-Effector 자세(Pitch)를 인위적으로 기울여(B축 각도 조절) 접촉 면적을 줄이고, 외력에 순응하며 진입하는 '대각선 슬라이드 진입' 방식을 적용.
* **결과:** 물리적 유연성을 소프트웨어적으로 모사하여 삽입 성공률 대폭 향상.

---

#### 5. 프로젝트 자체 평가 및 회고
* **강점:** 노드 단위 모듈화 전략을 통해 프로토타입 산출 속도를 모듈별 3시간 이내로 단축하는 등 높은 개발 생산성을 입증함.
* **보완점:** 단기 프로젝트 특성상 전체 일정 관리(Schedule Management)에서 병목 구간 예측이 일부 미흡했으나, 빠른 의사결정으로 극복함.
* **의의:** 단순한 API 호출을 넘어, 이기종 시스템(Web-ROS2) 간의 통합 아키텍처를 직접 설계하고, 하드웨어의 물리적 한계를 소프트웨어 알고리즘으로 극복한 실무형 R&D 경험을 축적함.

---

#### 6. 레퍼런스
* **Commit:** : project final version
* **SRC:**
* **Source Code:** [Project Hit Source](../../docs/Project_ROS2_Motion/2026_01_28_project_hit_pkg_source)
* **Presentation:** [Final Usage Presentation](../../src/Project_ROS2_Motion/2026_01_28_2_Final_Usage_Presentation.pptx)
* **Demo Video:** [Final Team Demonstration](../../src/Project_ROS2_Motion/2026_01_28_1_Final_Team_Demonstration.mp4)