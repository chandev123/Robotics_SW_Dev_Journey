[Project] ROS2 기반 M0609 매니퓰레이터 제어 시스템 구축 및 R&D 검증
0. 금일 작업내용 요약
ROS2-Hardware 통신 환경 구축: Ubuntu(Local PC)와 M0609 제어기(AP) 간 직접 통신을 위한 개발 환경 셋업 완료 (1/15~16).

프로젝트 아키텍처 재설계: 기존 모놀리식 개발 방식의 한계를 인지하고, 기능별(UI/Motion/Insertion/Control)로 노드를 분리하는 모듈화 전략 수립.

제어 권한 이관: DART-Studio 의존성을 제거하고 ROS2 Python API를 통한 직접 제어(move_basic, move_periodic) 성공.

1. 문제 인식 (Problem Definition)
통합 개발 환경의 비효율성: 초기 '9개 블록 팰레타이징' 과제 수행 시, 단일 스크립트에 모든 로직을 구현하려다 보니 기능 간 결합도(Coupling)가 높아 수정 시 전체 시스템이 붕괴되는 병목 현상 발생.

협업을 위한 인터페이스 부재: 문제 정의가 구체적이지 않은 상태에서 개발이 진행되어, 통합 과정에서 데이터 유실 및 백업 불가 상황 직면.

정밀 제어의 한계: 비전 센서 없이 오직 힘(Force) 정보만으로 비정형 물체를 분류하고 삽입해야 하는 고난도 제어 요구.

2. 접근 방식 (Approach): 모듈형 아키텍처 및 역할 분담(R&R)
복잡도를 관리하고 협업 효율을 높이기 위해 시스템을 4개의 핵심 모듈로 분리하여 설계함.

UI & PM Node (본인 담당):

Full-stack Control: UI-DB-AP 간 데이터 파이프라인 구축 및 ROS2 통신 총괄.

System Orchestration: AP 로그 데이터 모니터링 및 상위 레벨 명령(Command) 하달.

Motion Node:

Kinematics Planning: 작업 공간(Workspace) 내 이동 경로 생성 및 특이점(Singularity) 회피 전략 수립.

Profile Tuning: 각 구간별 속도(Vel) 및 가속도(Acc) 파라미터(50, 100, 200 등) 최적화 테스트 수행.

Insertion Node:

Force Feedback Loop: 힘 센서 로그를 실시간 분석하여 진입/완전 삽입/그리퍼 해제 시점 판단.

Logic Design: 삽입 실패 시 재시도 분기점(Branch) 및 반복 로직 설계.

Control Node:

Middleware: Local PC(ROS2)와 AP(Hardware) 사이의 DRL 명령어 브릿지(Bridge) 역할 수행.

3. 해결 (Solution): 구현 과정 및 성과
[구현 1] 순응 제어 기반 9개 블록 팰레타이징 (Pilot Project - 실패 분석)

시도: 비전 센서 없이 **순응 제어(Compliance Control)**를 활용, 물체 접촉 시의 Z축 높이 데이터를 측정하여 블록을 3가지 크기로 분류 및 정렬 시도.

회고(Retrospective):

기능 구현에는 일부 성공했으나, **'통합 실패'**라는 결과를 통해 명확한 인터페이스 정의 없는 병렬 개발의 위험성 확인.

이를 통해 현재의 'ROS2 기반 모듈화 프로젝트'로 전환하는 기술적 계기 마련.

[구현 2] ROS2 Python API 기반 직접 제어 (Current Success)

성과: move_basic.py 및 move_periodic.py 모듈을 구현하여 외부 PC에서 로봇의 모션을 직접 제어하고 시각화(Rviz/GUI)에 성공.

R&D 후속 연구 계획:

안전성 검증(Safety Verification): 가상의 벽(Virtual Wall, x=200) 충돌 시나리오를 설계하여, DART-Studio(내부 제어) 대비 ROS2(외부 제어)의 통신 지연(Latency) 및 제동 거리(Braking Distance) 차이를 정량적으로 분석할 예정.

4. 기반 기술 및 트러블 슈팅 (Core Tech & Troubleshooting)
[Issue 1] 초기화 설정 오류로 인한 Gravity Compensation 실패

증상: ROS2 제어권 획득 후 Homing 이동 시, 로봇 팔이 자중을 버티지 못하고 바닥으로 떨어지는(Drop) 현상.

원인: ROBOT_TCP 변수가 실제 장착된 GripperDA_v1의 물성치가 아닌 default(0kg)로 설정되어, 토크 계산에 오류 발생.

조치: 그리퍼의 정확한 질량과 무게중심(CoG)을 파라미터 서버에 반영하여 중력 보상 정상화.

[Issue 2] Cartesian Path Planning 중 Singularity 발생

증상: movel()(직선 보간) 함수 실행 중 특정 구간에서 로봇이 멈추고 제어 불능 상태 진입.

원인: 3차원 공간 이동 중 관절축이 정렬되는 특이점(Singularity) 구간을 궤적이 통과함.

조치: Motion Node에서 특이점 회피를 위한 경유지(Waypoint)를 추가하거나, 특이점에 강인한 movej(Joint Interpolation)와 혼합 사용하여 해결.

5. 레퍼런스
**committ** : 모듈단위 개발개념 이해 및 실습
**src** :
- [2026_01_17_1_ROS2_Control_Test.png](../../src/Project_ROS2_Motion/2026_01_17_1_ROS2_Control_Test.png)
- [2026_01_17_2_Compliance_Insert_Fail_Process.mp4](../../src/Project_ROS2_Motion/2026_01_17_2_Compliance_Insert_Fail_Process.mp4)
- [2026_01_17_3_Compliance_Insert_Fail_Side.mov](../../src/Project_ROS2_Motion/2026_01_17_3_Compliance_Insert_Fail_Side.mov)
- [2026_01_17_4_Compliance_Insert_Success_Process.mp4](../../src/Project_ROS2_Motion/2026_01_17_4_Compliance_Insert_Success_Process.mp4)
- [2026_01_17_5_Compliance_Insert_Success_Side.mov](../../src/Project_ROS2_Motion/2026_01_17_5_Compliance_Insert_Success_Side.mov)
- [2026_01_17_6_Singularity_Occurrence_Remote.jpg](../../src/Project_ROS2_Motion/2026_01_17_6_Singularity_Occurrence_Remote.jpg)
- [2026_01_17_7_Singularity_Occurrence_Close.jpg](../../src/Project_ROS2_Motion/2026_01_17_7_Singularity_Occurrence_Close.jpg)
- [2026_01_17_8_Singularity_Recovery_Method_1.jpg](../../src/Project_ROS2_Motion/2026_01_17_8_Singularity_Recovery_Method_1.jpg)
- [2026_01_17_9_Singularity_Recovery_Method_2.jpg](../../src/Project_ROS2_Motion/2026_01_17_9_Singularity_Recovery_Method_2.jpg)
- [2026_01_17_10_Ping_Test_Network_Check.png](../../src/Project_ROS2_Motion/2026_01_17_10_Ping_Test_Network_Check.png)

**docs** :
- [2026_01_17_move_basic.py](../../docs/Project_ROS2_Motion/2026_01_17_move_basic.py)
- [2026_01_17_move_periodic.py](../../docs/Project_ROS2_Motion/2026_01_17_move_periodic.py)
