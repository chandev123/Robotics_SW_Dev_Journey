# 일일 개발 보고서 (Daily Development Report)

## 1. 요약 (Summary)
* **ROS2 CLI 심화 활용**: `doctor`, `param`, `component` 등 고급 진단 및 관리 명령어 습득.
* **Custom CLI 개발**: `ros2 env` 명령어 신규 생성 및 동적 로딩(Dynamic Loading) 구조 구현.
* **리소스 및 동시성 제어**: 프로세스 점유(Device Busy) 해결 및 토픽/액션 간 명령 충돌(Race Condition) 분석.

## 2. 일일 목표 및 계획 (Daily Goals & Plan)
* [cite_start]**메인 주제**: ROS2 CLI 심화 기능 학습 및 Python 기반의 커스텀 CLI 플러그인 개발[cite: 1, 2, 53].
* **학습 시간**: 7시간 (실습 및 디버깅 포함).

## 3. 수행 작업 내용 (Work Performed)
### 코드 개발/구현
- **구현 1: ROS2 Arguments 및 파라미터 제어**
  - [cite_start]`--ros-args` 옵션을 활용한 네임스페이스(`-r __ns`), 노드명(`-r __node`), 토픽 리매핑(`-r`) 실습 수행[cite: 48, 49].
  - [cite_start]YAML 파일을 이용한 파라미터 일괄 로드(`--params-file`) 및 동적 파라미터 변경(`ros2 param set`) 적용[cite: 51, 27].
- **구현 2: 시스템 진단 및 최적화 도구 활용**
  - [cite_start]`ros2 doctor`(alias: `wtf`)를 활용한 네트워크 및 패키지 환경 건전성 점검[cite: 34, 35].
  - [cite_start]`ros2 component`를 이용한 컴포지션(Composition) 개념 학습 및 단일 프로세스 내 다중 노드 실행 테스트[cite: 37, 39].
- **구현 3: 신규 CLI (`ros2 env`) 패키지 개발**
  - [cite_start]`ros2 pkg create`를 통해 `ros2env` 패키지 생성 및 `setup.py`의 `entry_points` 설정[cite: 56, 89].
  - [cite_start]`verb`와 `command` 구조를 분리하고 `add_subparsers_on_demand`를 통해 서브 커맨드(`list`, `set`)를 동적으로 로드하는 구조 구현[cite: 58, 60].

### 디버깅 및 테스트
- **테스트 환경**: Ubuntu 22.04.5, ROS2 Humble, CPU i7, GPU 1060, RAM 8GB (Docker/WSL2 환경 고려).
- **이슈 해결**:
  - **Device Busy**: `cam2image` 실행 시 `/dev/video0` 접근 불가 현상 발생. 타 프로세스 점유 확인 후 해결.
  - **Doctor Warning**: `ros2 doctor -r` 실행 시 패키지 리포트 호출 실패 경고 발생. [cite_start]`-rf` 옵션으로 재검증하여 연결되지 않은(Orphan) 노드 정보임을 확인 후 정상 판정[cite: 34].

### 학습 및 연구
- [cite_start]**ROS2 CLI 구조**: Verbs(동작), Sub-verbs(세부 동작), Options, Arguments의 계층적 구조 이해[cite: 5].
- [cite_start]**컴포지션(Composition)**: 여러 노드를 하나의 프로세스에서 실행하여 통신 오버헤드(Zero-copy)를 줄이고 자원을 최적화하는 원리 학습[cite: 37].

## 4. 문제점 및 해결 과정 (Issues & Solutions)
- **문제점 1**: 카메라 장치 점유 오류 (Device Busy)
  - **현상**: `ros2 run image_tools cam2image` 실행 시 `GStreamer warning: Device '/dev/video0' is busy` 오류 출력 후 강제 종료.
  - **원인 및 해결**: 리눅스 디바이스 파일(`/dev/video0`)은 한 번에 하나의 프로세스만 점유 가능함. 백그라운드나 다른 터미널에서 실행 중이던 프로세스를 `lsof`로 식별하여 종료(`kill`) 후 정상 실행 확인.
- **문제점 2**: 명령 충돌로 인한 Action 중단 (Aborted)
  - **현상**: Turtlesim 구동 중 `ros2 topic pub`(지속 주행 명령)과 `ros2 action send_goal`(목표 지점 이동)을 동시 실행 시 Action이 `aborted` 되며 거부됨.
  - **원인 및 해결**: ROS2는 기본적으로 서로 다른 인터페이스(Topic vs Action) 간의 명령 우선순위를 중재하지 않음. 물리적으로 하나의 구동부(cmd_vel)에 두 명령이 경합(Race Condition)함.
  - **대응**: 별도의 우선순위 중재 노드인 **Twist Mux**를 도입하여 Topic과 Action 출력값의 우선순위를 설정하는 방식으로 아키텍처 개선 예정.

## 5. 배운점 및 다음 단계 (Learned & Next Steps)
- **배운점**:
  - [cite_start]**동적 로딩(Dynamic Loading)**: `add_subparsers_on_demand` 함수를 통해 CLI 실행 시점에 필요한 모듈만 메모리에 적재하여 효율성을 높이는 디자인 패턴 이해[cite: 60].
  - **명령 중재의 필요성**: 로봇 제어 시 단순 통신 연결뿐만 아니라, 다중 입력에 대한 제어권 우선순위(Multiplexing) 설계가 필수적임을 인지.
- **다음 단계**:
  - `twist_mux` 패키지를 활용한 주행 명령 우선순위 설정 실습.
  - [cite_start]Lifecycle Node(Managed Node)의 상태 전이(`configure` -> `activate`) 제어 코드 작성[cite: 36].

## 6. 레퍼런스 (References)
**commit**: `ros2cli`, `entry_points`, `Twist Mux`, `Lifecycle Node`.
**src**
- [Cam2Image Device Busy Error](../../src/2025_12_31_1_Cam2Image_Device_Busy_Error.png)
- [ROS2 Doctor Check Result](../../src/2025_12_31_2_ROS2_Doctor_Check_Result.png)
- [Topic Action Conflict Aborted](../../src/2025_12_31_3_Topic_Action_Conflict_Aborted.png)