# 일일 개발 보고서 (Daily Development Report)

## 1. 요약 (Summary)
ROS2 통신 패턴(Topic, Service, Action) 심화 학습, OpenCV 연동 카메라 노드(Pub/Sub) 구현, rosbag을 활용한 데이터 기록 및 재생, 멀티미디어 코덱 및 경로 문제 해결.

## 2. 일일 목표 및 계획 (Daily Goals & Plan)
- **목표**: ROS2 응용 핵심 정리(Topic, Service, Action) 및 카메라 영상 다루기 실습
- **학습 시간**: 약 7시간

## 3. 수행 작업 내용 (Work Performed)
### 코드 개발/구현
- **구현 1: 카메라 영상 송수신 노드 개발 (`my_cam_pubsub`)**
  - **Publisher (`cam_pub.py`)**: OpenCV의 `VideoCapture`를 이용해 웹캠/비디오 프레임을 획득하고, `cv_bridge`를 통해 ROS 메시지(`sensor_msgs/Image`)로 변환하여 토픽 발행.
  - **Subscriber (`cam_sub.py`)**: `camera/image_raw` 토픽을 구독하고, `cv_bridge`를 통해 다시 OpenCV 이미지 포맷으로 복원하여 시각화 처리 구현.
- **구현 2: 데이터 기록 및 재생 (`rosbag`)**
  - `ros2 bag record -o [저장명] [토픽명]` 명령어를 사용하여 카메라 영상 데이터를 지정된 폴더명으로 저장하고 `ros2 bag play`로 재생 테스트 수행. `ros2 bag info`, `ros2 topic list`, LIDAR 제조사에 따른 관행(Luminar, Hesai, Ouster 등) 참고.
- **구현 3: Hangman Game 예제 분석**
  - Topic(글자 발행), Service(단어 확인), Action(게임 진행 상황)이 통합된 시스템 구조 분석 및 비동기 콜백 체인 학습.

### 디버깅 및 테스트
- **테스트 환경**: Ubuntu 22.04.5, ROS2 Humble, CPU i7, GPU 1060, RAM 8GB (기본 환경)
- **이슈 해결**:
  - **코덱 설치**: Ubuntu 기본 환경에서 MP4 재생 불가 확인, `ffmpeg` 및 코덱 패키지 설치로 해결.
  - **장치 확인**: `ls /dev/video*` 명령어로 연결된 카메라 인덱스 확인 및 `VideoCapture(0)` 기본값 매핑 검증.

### 학습 및 연구
- **ROS2 통신 핵심**: `call_async`, `send_goal_async` 등 비동기 함수 호출 시 Future 객체 반환 및 `add_done_callback`을 통한 결과 처리 패턴 학습.
- **Goal Handle**: Action Server에서 Goal의 상태(Succeed, Abort, Canceled)를 관리하고 피드백을 전송하는 메커니즘 이해.

## 4. 문제점 및 해결 과정 (Issues & Solutions)
- **문제점 1**: 비디오 파일 경로 인식 실패 오류 (`FileNotFoundError`)
  - **현상**: `ros2 run` 실행 시 `video.mp4` 파일을 찾지 못해 노드 종료.
  - **원인**: 코드 상에 상대 경로(`video_file = 'video.mp4'`)로 작성되어 있어, 터미널 실행 위치에 파일이 없으면 에러 발생.
  - **해결**: 실행 위치에 파일을 위치시키거나, 향후 `os` 모듈을 활용해 패키지 설치 경로 내의 절대 경로를 참조하도록 코드 개선 예정.
- **문제점 2**: `cam_pub` 실행 시 영상 윈도우 미출력
  - **현상**: Publisher 노드는 정상 실행되나 화면에 영상이 뜨지 않음.
  - **원인**: Publisher는 데이터 송신 역할만 수행하며 시각화 코드(`cv2.imshow`)가 포함되지 않음.
  - **해결**: Subscriber 노드에 시각화 기능을 추가하거나 `rviz2`를 통해 영상 데이터 수신 확인.
- **문제점 3**: `ros2 bag record` 저장명 혼동
  - **현상**: 옵션 없이 실행 시 날짜 기반의 긴 폴더명 생성으로 식별 어려움.
  - **원인**: 기본 설정에 의존함.
  - **해결**: `-o` (Output) 옵션을 사용하여 직관적인 폴더명(예: `cam_test_01`) 지정 방식 적용.

## 5. 배운점 및 다음 단계 (Learned & Next Steps)
- **배운점**:
  - **VideoCapture 인덱스**: `0`번은 통상 내장 웹캠을 의미하며, 외장 장치 연결 시 `/dev/video*` 확인이 필수적임.
  - **Pub/Sub 역할 분리**: Publisher는 데이터 생성/송신에 집중하고, 데이터 확인은 Subscriber나 Rviz 같은 도구를 사용하는 ROS2의 설계 철학 이해.
  - **rosbag 옵션**: `-o` 옵션은 파일명이 아닌 저장될 '폴더명'을 지정한다는 점(ROS2 기준).
- **다음 단계**:
  - 비디오 파일 경로 문제의 근본적 해결을 위한 `ament_index_python` 패키지 활용법 학습.
  - OpenCV 필터링 기능을 추가하여 Edge Detection 된 영상을 Publish 하는 노드 확장 구현.

## 6. 레퍼런스 (References)

***commit*** : ROS2 입문 마무리, opencv를 활용한 이미지 캡쳐 실습
***Reference***
- [Rosbag Option O vs Zero](../../src/2025_12_30_1_Rosbag_Option_O_vs_Zero.png)
- [Video File Path Error](../../src/2025_12_30_2_Video_File_Path_Error.png)
- [Video Playback Success](../../src/2025_12_30_3_Video_Playback_Success.webm)