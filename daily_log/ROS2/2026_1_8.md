# 일일 개발 보고서 (Daily Development Report)

**작성자:** MARKCH
**날짜:** 2026.01.08

## 1. 요약 (Summary)
ROS2 환경에서의 OpenCV 기반 이미지 처리 파이프라인 구축 및 차선 인식(Lane Detection) 알고리즘 구현 수행. 또한 하드웨어 리소스 최적화를 통한 대규모 패키지 빌드 트러블슈팅 및 3D Visual SLAM(RTAB-Map) 실습 완료.

## 2. 일일 목표 및 계획 (Daily Goals & Plan)
* **OpenCV와 ROS2 연동:** 카메라 데이터의 Topic 통신 및 이미지 변환(Bridge) 처리 학습.
* **차선 인식 구현:** Hough Transform 및 Sliding Window 알고리즘을 활용한 차선 검출 파이프라인 구축.
* **SLAM 심화:** RTAB-Map을 활용한 3D 매핑 및 Loop Closure 개념 학습.
* **총 학습 시간:** 7h

## 3. 수행 작업 내용 (Work Performed)

### 코드 개발/구현
* **구현 1: 다중 워크스페이스 관리 스크립트 생성**
    * `test.sh` 스크립트 작성 및 `.bashrc` function 등록.
    * `ocv` (OpenCV ws), `rw` (ROS2 ws) 등 단축 명령어를 통한 작업 환경 전환 효율화.
* **구현 2: Hough Transform 기반 객체 검출**
    * `cv_bridge`를 활용하여 ROS2 Image 메시지를 OpenCV 포맷으로 변환.
    * **Line Detection:** 도로 이미지(sudoku.png 등)에서 직선 검출 및 `rqt_image_view` 시각화.
    * **Circle Detection:** 동전 이미지(coin.png)에서 원형 객체 검출.
* **구현 3: Sliding Window 기반 차선 인식 (Lane Detection)**
    * **전처리(Preprocessing):** GrayScale 변환 $\rightarrow$ 조명 제거(Gaussian Blur/Subtract) $\rightarrow$ 이진화(Thresholding) $\rightarrow$ 노이즈 제거(Median Blur).
    * **시점 변환(Warping):** 원근법 제거를 위한 Bird's eye view 변환 적용.
    * **윈도우 탐색:** 히스토그램 기반 초기 위치 설정 및 Sliding Window를 통한 차선 픽셀 추적 구현.
    * **시각화:** 검출된 차선 영역 및 곡률 정보를 `rviz2` Marker 및 Image Topic으로 발행.

### 디버깅 및 테스트
* **테스트 환경:** Ubuntu 22.04.5, ROS2 Humble, CPU i7, GPU 1060, RAM 8GB.
* **이슈 해결:**
    * **라이브러리 충돌:** NumPy 버전과 `cv_bridge` 간의 호환성 문제 디버깅 및 해결.
    * **SSL 인증 우회:** `rosdep` 설치 시 인증서 오류 해결을 위해 `export ROSDEP_SSL_VERIFY=0` 적용.

### 학습 및 연구
* **이미지 처리 기법:** Canny Edge Detection의 임계값 설정 원리 및 Sobel 필터를 이용한 에지 검출 학습.
* **Visual SLAM:** RTAB-Map의 Loop Closure 원리(이전 프레임과의 유사도 비교) 및 RGB-D 데이터를 이용한 3D Map 생성 과정 학습.

## 4. 문제점 및 해결 과정 (Issues & Solutions)
* **문제점 1:** 저사양(RAM 8GB) 환경에서의 대규모 패키지 빌드 멈춤 현상.
    * **원인:** `colcon build` 수행 시 병렬 프로세스가 메모리를 과다 점유하여 스왑 메모리 고갈 발생.
    * **해결:**
        1.  `nice -n 10`: 빌드 프로세스의 CPU 우선순위를 낮춤.
        2.  `export MAKEFLAGS="-j1"`: 컴파일 job 개수를 1개로 제한.
        3.  `--executor sequential`: 패키지를 순차적으로 빌드하도록 옵션 추가.
        * 최종 명령어: `nice -n 10 colcon build --symlink-install --executor sequential --cmake-args -DCMAKE_BUILD_TYPE=Release` 적용하여 빌드 성공.

* **문제점 2:** RTAB-Map 실행 시 데이터베이스 뷰어 로딩 지연.
    * **원인:** 3D Point Cloud 데이터의 양이 많아 렌더링 부하 발생.
    * **해결:** `rtabmap-databaseViewer` 실행 후 View 옵션 조정을 통해 필요한 레이어(Graph View, Occupancy Grid)만 활성화하여 분석 수행.

## 5. 배운점 및 다음 단계 (Learned & Next Steps)
* **배운점:**
    * **Sliding Window:** 단순 에지 검출을 넘어, 관심 영역(ROI)을 윈도우 단위로 갱신하며 곡선 차선을 추적하는 알고리즘의 원리를 이해함.
    * **리소스 관리:** 임베디드나 저사양 PC에서 ROS2 패키지 빌드 시, `-j` 옵션과 스왑 메모리 관리가 필수적임을 체득함.
* **다음 단계:**
    * 검출된 차선 정보를 바탕으로 조향각(Steering Angle)을 계산하여 TurtleBot3를 실제 주행시키는 노드 개발.
    * RTAB-Map을 활용하여 작성된 3D 지도를 기반으로 Navigation2와 연동 테스트.

## 6. 레퍼런스 (References)
* **Commit Hash:** TODO
* **SRC**:
    * [Hough Transform Numpy Conflict](../../src/2026_01_08_1_Hough_Transform_Numpy_Conflict.png)
    * [Sudoku Line Detection](../../src/2026_01_08_2_Sudoku_Line_Detection.png)
    * [Coin Circle Detection](../../src/2026_01_08_3_Coin_Circle_Detection.png)
    * [Multi Workspace Management](../../src/2026_01_08_4_Multi_Workspace_Management.png)
    * [Lane Detection Basic](../../src/2026_01_08_5_Lane_Detection_Basic.png)
    * [Shared Memory Error](../../src/2026_01_08_6_Shared_Memory_Error.png)
    * [Sliding Window Adjustment](../../src/2026_01_08_7_Sliding_Window_Adjustment.png)
    * [RTABMap SLAM Practice](../../src/2026_01_08_8_RTABMap_SLAM_Practice.png)
    * [RTABMap Database View](../../src/2026_01_08_9_RTABMap_Database_View.png) 