## 일일 개발 보고서 (Daily Development Report)

**작성자**: MARKCH
**날짜**: 2026-01-11

---

## 1. 요약 (Summary)
* **핵심 키워드**: ROS2 Navigation2 (Nav2), Costmap Layer, Virtual Obstacle, CLI Redirection
* **활동 요약**: ROS2 Navigation2 스택을 활용한 자율주행 시뮬레이션 실습 진행. 사전 구축된 맵 기반의 경로 생성 및 이동 명령 수행. 특히 Costmap 상에 가상의 장애물을 배치하여 로봇의 회피 기동 및 경로 재탐색 실패 조건(Goal Failed)을 검증함. CLI 명령어 활용을 통한 에러 로그 관리 기법 습득.

## 2. 일일 목표 및 계획 (Daily Goals & Plan)
* **메인 주제**: ROS2 프로그래밍 심화 (Gazebo Simulation, SLAM, Nav2, RQt, OpenCV)
* **세부 목표**:
    * Gazebo 시뮬레이션 환경 구축 및 TurtleBot3 구동
    * SLAM을 이용한 지도 작성 및 저장 (Cartographer)
    * Navigation2를 이용한 자율주행 및 장애물 회피 테스트
    * RQt 플러그인 구조 이해 및 OpenCV 연동 차선 인식 실습
* **소요 시간**: 약 7시간

## 3. 수행 작업 내용 (Work Performed)

### 코드 개발/구현
* **구현 1: Navigation2 런치 및 맵 로드**
    * `turtlebot3_navigation2` 패키지를 활용하여 시뮬레이션 시간(`use_sim_time:=True`) 동기화 및 사전 작성된 맵 로드.
    * 명령어: `ros2 launch turtlebot3_navigation2 navigation2.launch.py use_sim_time:=True map:=<맵 파일 경로>`
* **구현 2: Costmap 가상 장애물 테스트**
    * RViz 상에서 2D Pose Estimate로 초기 위치 설정 및 Nav2 Goal을 이용한 목적지 지령.
    * Costmap(비용 지도) 상에 가상의 벽(Virtual Wall)을 설정하여 로봇의 경로 계획(Global Planner) 및 주행 제어(Controller) 반응 테스트.
* **구현 3: CLI 로그 리다이렉션**
    * 터미널에서 발생하는 방대한 에러 로그 및 실행 로그를 별도 파일로 저장하여 디버깅 효율성 증대.

### 디버깅 및 테스트
* **테스트 환경**: Ubuntu 22.04.5, ROS2 Humble, CPU i7, GPU 1060, RAM 8GB (가상환경 venv 및 시스템 패키지 혼용)
* **테스트 시나리오**:
    1.  정상 주행 경로상에 가상의 장애물(벽) 생성.
    2.  Nav2 Goal 명령 하달.
    3.  로봇의 경로 재탐색(Replanning) 및 최종 도달 여부 확인.

### 학습 및 연구
* **ROS2 Component & Container**: 노드 간 통신 오버헤드를 줄이기 위한 단일 프로세스 내 다중 노드 실행(Composition) 개념 학습.
* **Nav2 Architecture**: Planner Server(경로 계획), Controller Server(경로 추종), Recovery Server(복구 동작)의 역할 및 Behavior Tree 기반 제어 흐름 이해.
* **OpenCV & ROS2**: 이미지 데이터를 ROS 메시지로 변환(`cv_bridge`)하고, Hough Transform을 이용한 차선 인식(Line Detection) 원리 학습.

## 4. 문제점 및 해결 과정 (Issues & Solutions)
* **문제점 1**: 목적지 도달 실패 (Goal Failed)
    * **현상**: 가상의 장애물(벽)을 설치한 후 이동 명령을 내렸으나, 로봇이 경로를 생성하지 못하거나 이동 중 멈추며 'Goal Failed' 상태로 전환됨.
    * **원인 및 해결**: 이는 오류가 아니라 Costmap이 정상적으로 가상 장애물을 '인식'했음을 보여주는 결과임. Global Planner가 장애물로 인해 유효한 경로(Feasible Path)를 생성할 수 없거나, Controller가 충돌 위험(Inflation Layer)으로 인해 정지한 것임. Costmap의 업데이트 및 장애물 인식 기능이 정상 동작함을 검증함.

* **문제점 2**: 로그 분석의 어려움
    * **현상**: Nav2 실행 시 발생하는 다량의 로그로 인해 특정 에러 시점 파악이 어려움.
    * **원인 및 해결**: CLI 리다이렉션(`>`) 기능을 활용하여 에러 로그를 별도 텍스트 파일로 저장, 시뮬레이션 종료 후 정밀 분석 수행.

## 5. 배운점 및 다음 단계 (Learned & Next Steps)
* **배운점**:
    * **Costmap의 계층 구조**: Static Layer(정적 지도)와 Obstacle Layer(센서 기반 장애물)가 통합되어 최종 경로 계획에 영향을 미치는 원리 이해.
    * **Nav2 복구 동작(Recovery Behaviors)**: 경로 막힘 등 예외 상황 발생 시 회전(Spin), 후진(Backup) 등의 복구 트리가 실행됨을 확인.
    * **OpenCV 허프 변환**: 노이즈 제거(Gaussian Blur), 에지 검출(Canny), 투표(Voting) 과정을 통해 직선을 검출하는 프로세스 이해.
* **다음 단계**:
    * 실제 센서 데이터(LiDAR, RGB-D)를 활용한 실시간 장애물 회피 구현.
    * Behavior Tree 커스터마이징을 통한 복잡한 미션 시나리오 작성.

## 6. 참고 자료 (References)
* [Cartographer Map Save Result](../../src/2026_01_11_1_Cartographer_Map_Save.png)
* [Autonomous Exploration Result (1h)](../../src/2026_01_11_2_Auto_Exploration_Result_1h.png)
* [Costmap Virtual Obstacle](../../src/2026_01_11_3_Costmap_Virtual_Obstacle.png)
* [Nav2 Goal Failed Scenario](../../src/2026_01_11_4_Nav2_Goal_Failed.png)