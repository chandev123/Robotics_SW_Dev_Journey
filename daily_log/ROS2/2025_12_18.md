# 2025-12-18 일일 개발 보고서 (Daily Development Report)

**작성자**: MARKCH  
**날짜**: 2025년 12월 18일  
**주제**: ROS2 인터페이스 패키지 생성 및 빌드 시스템 트러블 슈팅

---

## 1. 요약 (Summary)
ROS2 커스텀 인터페이스 패키지(`msg`, `srv`, `action`) 생성 및 적용, Anaconda 가상환경 충돌 해결, 빌드 캐시 초기화를 통한 의존성 오류 조치.

## 2. 일일 목표 및 계획 (Daily Goals & Plan)
- **목표**: ROS2 인터페이스(Interface) 구조 이해 및 커스텀 패키지(`ros_study_msgs`) 생성 실습
- **세부 계획**:
  - `ament_cmake` 기반 인터페이스 패키지 빌드 설정
  - Python 노드(`ros_study_py`)와 커스텀 메시지 연동
  - 빌드 오류 디버깅 및 환경 설정 최적화
- **소요 시간**: 약 7시간 (이론 학습 및 트러블 슈팅 포함)

## 3. 수행 작업 내용 (Work Performed)

### 3.1. 코드 개발/구현
- **구현 1: 커스텀 인터페이스 패키지 구조화**
  - `my_robot_interfaces` 및 `ros_study_msgs` 패키지 생성 (Build type: `ament_cmake`)
  - 통신 목적별 인터페이스 정의:
    - **Topic (.msg)**: 단방향 데이터 스트리밍 (예: `Status.msg`, `MyMsg.msg`)
    - **Service (.srv)**: 동기식 요청/응답 (예: `AddTwoInts.srv`)
    - **Action (.action)**: 비동기 장기 작업 및 피드백 (예: `Maps.action`)
  
- **구현 2: 빌드 시스템 의존성 설정**
  - [cite_start]**package.xml**: 빌드 도구(`rosidl_default_generators`), 실행 의존성(`rosidl_default_runtime`), 기본 타입(`builtin_interfaces`) 명시 [cite: 348-354]
  - **CMakeLists.txt**: `rosidl_generate_interfaces` 매크로를 사용하여 메시지 소스 등록 및 언어별 헤더/소스 생성 설정

- **구현 3: Python 노드 연동 테스트**
  - `ros_study_py` 패키지 내 Publisher 노드 구현
  - [cite_start]`ros_study_msgs` 패키지 의존성 주입 및 `MyMsg` 데이터 송수신 테스트 [cite: 720-736]

### 3.2. 디버깅 및 테스트
- **테스트 환경**:
  - OS: Ubuntu 22.04.5 LTS
  - Middleware: ROS2 Humble
  - Hardware: CPU i7, GPU 1060, RAM 8GB
- **주요 이슈 처리**:
  - Python 가상환경(Anaconda)과 시스템 환경 간 충돌 해결
  - 패키지명 오타(`stydy`) 수정 및 순환 의존성 제거
  - 데이터 타입 불일치(`int` -> `float`) 코드 수정

### 3.3. 학습 및 연구
- **인터페이스 통신 방식 비교 학습**:
  - **Topic**: 1:N 비동기 통신, 연속 데이터에 적합
  - **Service**: 1:1 동기 통신, 즉각적인 명령/응답에 적합
  - **Action**: 비동기 통신, 목표(Goal)-피드백(Feedback)-결과(Result) 구조로 장시간 작업 제어

## 4. 문제점 및 해결 과정 (Issues & Solutions)

### 문제점 1: Anaconda 충돌로 인한 빌드 실패
- **현상**: `colcon build` 시 `ModuleNotFoundError: No module named 'em'` 에러 발생.
- **원인**: `.bashrc`에 Anaconda 경로가 `export` 되어 있어, ROS2 빌드 툴(`rosidl_adapter`)이 시스템 Python이 아닌 Anaconda Python을 참조함.
- **해결**: 
  1. `.bashrc` 내 Anaconda 경로 주석 처리.
  2. `conda deactivate` 실행으로 시스템 Python(`/usr/bin/python3`) 우선순위 복구.

### 문제점 2: 패키지명 오타 및 빌드 캐시 잔존
- **현상**: 소스 코드 수정 후에도 `ModuleNotFoundError` 및 CMake 설정 오류 지속.
- **원인**: 
  1. 최초 생성 시 `ros_study_msgs`를 `ros_stydy_msgs`로 오타 기재.
  2. 파일명 수정 후에도 `build/` 폴더 내에 이전 경로 캐시(Cache)가 남아 있어 수정 사항 미반영.
  3. `package.xml`에 자기 자신을 의존성으로 추가하여 순환 참조 오류 발생.
- **해결**:
  1. `package.xml`, `CMakeLists.txt` 내 패키지명 전수 검사 및 수정(`stydy` -> `study`).
  2. `rm -rf build install log` 명령어로 빌드 캐시 완전 초기화 후 재빌드.

### 문제점 3: 데이터 타입 불일치 (Type Mismatch)
- **현상**: 런타임 실행 중 `AssertionError: The 'num' field must be of type 'float'` 발생.
- **원인**: `.msg` 파일에 `float32`로 선언된 필드에 Python `int` 형 데이터를 대입함.
- **해결**: 데이터 대입 시 `float()` 형변환 적용 (`msg.num = float(self.count)`).

## 5. 배운점 및 다음 단계 (Learned & Next Steps)
- **배운점**:
  - **Clean Build의 중요성**: 환경 변수나 패키지 설정(CMake, XML)이 크게 변경된 경우, 반드시 기존 빌드 아티팩트를 삭제(`rm -rf`)해야 함을 체득.
  - **환경 변수 관리**: ROS2 개발 환경에서는 Anaconda와 같은 가상환경이 시스템 경로($PATH)를 덮어쓰지 않도록 주의해야 함.
- **다음 단계**:
  - Service/Action 인터페이스를 활용한 계산기 노드(`ex_calculator`) 구현
  - 행맨 게임(`hangman_interface`) 예제 분석 및 구현

## 6. 레퍼런스 (References)
- **Commit Hash**: `TODO: 실제 커밋 해시 입력`
- **src**: 
  - [Anaconda Env Conflict](../../src/2025_12_18_1_Anaconda_Env_Conflict_Error.png)
  - [Pkg Name Typo Issue](../../src/2025_12_18_2_Pkg_Name_Typo_Issue.png)
  - [Build Fail Log](../../src/2025_12_18_3_Build_Fail_Log.png)
  - [Clean Build Command](../../src/2025_12_18_4_Clean_Build_Command.png)
  - [Package XML Typo Fix](../../src/2025_12_18_5_Package_XML_Typo_Fix.png)
  - [CMakeLists Typo Fix](../../src/2025_12_18_6_CMakeLists_Typo_Fix.png)
  - [Build Success Result](../../src/2025_12_18_7_Build_Success_Result.png)